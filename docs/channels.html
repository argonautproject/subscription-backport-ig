<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE HTML>
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>HL7.FHIR.UV.SUBSCRIPTIONS-BACKPORT\Channels - FHIR v4.1.0</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="author" content="http://hl7.org/fhir"/>

    <link rel="stylesheet" href="fhir.css"/>

      <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="assets/css/bootstrap-fhir.css"/>

      <!-- Project extras -->
    <link rel="stylesheet" href="assets/css/project.css"/>
    <link rel="stylesheet" href="assets/css/pygments-manni.css"/>
    <link rel="stylesheet" href="assets/css/jquery-ui.css"/>
  	<link rel="stylesheet" href="assets/css/prism.css"/>
      <!-- Placeholder for child template CSS declarations -->
    <link rel="stylesheet" href="assets/css/hl7.css"/>
    <link rel="stylesheet" href="assets/css/fhir.css"/>

    <script src="fhir-table-scripts.js" type="text/javascript"> </script>

      <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
      <!-- [if lt IE 9]>
    <script src="assets/js/html5shiv.js"></script>
    <script src="assets/js/respond.min.js"></script>
    <![endif] -->

      <!-- Favicons -->
    <link sizes="144x144" rel="apple-touch-icon-precomposed" href="assets/ico/apple-touch-icon-144-precomposed.png"/>
    <link sizes="114x114" rel="apple-touch-icon-precomposed" href="assets/ico/apple-touch-icon-114-precomposed.png"/>
    <link sizes="72x72" rel="apple-touch-icon-precomposed" href="assets/ico/apple-touch-icon-72-precomposed.png"/>
    <link rel="apple-touch-icon-precomposed" href="assets/ico/apple-touch-icon-57-precomposed.png"/>
    <link rel="shortcut icon" href="assets/ico/favicon.png"/>
  </head>
  <body onload="document.body.style.opacity='1'">

	  <script src="assets/js/prism.js"></script>

    <style type="text/css">h2{--heading-prefix:"3.4"}
    h3,h4,h5,h6{--heading-prefix:"3.4"}</style>
    <div id="segment-header" class="segment">    <!-- segment-header -->
      <div class="container">    <!-- container -->
          <!-- Placeholder for child template header declarations -->

        <div id="hl7-nav">
          <a no-external="true" id="hl7-logo" href="http://hl7.org">
            <img src="assets/images/hl7-logo-header.png" alt="Visit the HL7 website" height="50"/>
          </a>
        </div>
        <div id="family-nav">
          <a no-external="true" id="family-logo" href="http://hl7.org/fhir"><img src="assets/images/fhir-logo-www.png" alt="Visit the FHIR website" height="50"/> </a>
        </div>
        <div id="hl7-search">
          <a no-external="true" id="hl7-search-lnk" href="searchform.html"><img src="assets/images/search.png" alt="Search FHIR"/></a>
        </div>


        <div id="ig-status">
          <p><span style="font-size:12pt;font-weight:bold">Subscriptions R5 Backport</span><br/>0.1.0 - ballot</p>
        </div>
      </div>   <!-- /container -->
    </div>    <!-- /segment-header -->

    <div id="segment-navbar" class="segment">    <!-- segment-navbar -->
      <div id="stripe"> </div>
      <div class="container">    <!-- container -->
          <!-- HEADER CONTENT -->

        <nav class="navbar navbar-inverse">
            <!-- status-bar -->
          <div class="container">
            <button data-target=".navbar-inverse-collapse" data-toggle="collapse" type="button" class="navbar-toggle">
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
            </button>
            <a href="http://build.fhir.org/index.html" class="navbar-brand hidden">FHIR</a>
            <div class="nav-collapse collapse navbar-inverse-collapse">
                <!-- menu.xml -->

<ul class="nav navbar-nav">
  <li>
    <a href="index.html">IG Home</a>
  </li>
  <li>
    <a href="toc.html">Contents</a>
  </li>
  <li>
    <a href="background.html">Background</a>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Specification
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="actors.html">Actors</a>
      </li>
      <li>
        <a href="components.html">Topic-Based Subscription Components</a>
      </li>
      <li>
        <a href="workflow.html">Workflow</a>
      </li>
      <li>
        <a href="channels.html">Channels</a>
      </li>
      <li>
        <a href="notifications.html">Notifications</a>
      </li>
      <li>
        <a href="payloads.html">Payload Types</a>
      </li>
      <li>
        <a href="conformance.html">Conformance</a>
      </li>
      <li>
        <a href="errors.html">Handling Errors</a>
      </li>
    </ul>
  </li>
  <li>
    <a href="safety_security.html">Safety and Security</a>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Artifacts
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="artifacts.html#1">Capability Statements</a>
      </li>
      <li>
        <a href="artifacts.html#2">Operations</a>
      </li>
      <li>
        <a href="artifacts.html#3">Profiles</a>
      </li>
      <li>
        <a href="artifacts.html#4">Extensions</a>
      </li>
      <li>
        <a href="artifacts.html#5">Value Sets</a>
      </li>
      <li>
        <a href="artifacts.html#7">Examples</a>
      </li>
    </ul>
  </li>
  <li>
    <a href="downloads.html">Downloads</a>
  </li>
</ul>
            </div>    <!-- /.nav-collapse -->
          </div>    <!-- /.container -->
        </nav>    <!-- /.navbar -->
        <!-- /HEADER CONTENT -->
      </div>    <!-- /container -->
    </div>    <!-- /segment-navbar -->
      <!-- status-bar -->

    <div id="segment-breadcrumb" class="segment">    <!-- segment-breadcrumb -->
      <div class="container">    <!-- container -->
        <ul class="breadcrumb">
          <li><a href="toc.html"><b>Table of Contents</b></a></li><li><a href="specification.html"><b>Specification</b></a></li><li><b>Channels</b></li>

        </ul>
      </div>    <!-- /container -->
    </div>    <!-- /segment-breadcrumb -->

    <a name="top"> </a>
    <div id="segment-content" class="segment">    <!-- segment-content -->
      <div class="container">    <!-- container -->
        <div class="row">
          <div class="inner-wrapper">

<style type="text/css">
h2:before{color:silver;counter-increment:section;content:var(--heading-prefix) " ";}
h3:before{color:silver;counter-increment:sub-section;content:var(--heading-prefix) "." counter(sub-section) " ";}
h4:before{color:silver;counter-increment:composite;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) " ";}
h5:before{color:silver;counter-increment:detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) " ";}
h6:before{color:silver;counter-increment:more-detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) "." counter(more-detail)" ";}
</style>
<div class="col-12">
    <!-- ReleaseHeader --><p id="publish-box">Subscriptions R5 Backport - Local Development build (v0.1.0). See the <a href="http://hl7.org/fhir/uv/subscriptions-backport/history.html">Directory of published versions</a></p>  <!-- EndReleaseHeader -->
  <h2>Channels</h2>
  









    <p>  <!-- white space is critical inside of capture --></p>
<div>
  <!-- do not remove - needed to prevent Jekyll from adding a p tag to any non block level element in the markdown. -->
</div>

<p>In FHIR R5, there are four channel types which were common enough to be defined in the specification (additional channel types can be defined externally).  In this Implementation Guide, we define those same channel types; additional channel definitions may be defined by other implementations or Implementation Guides.</p>

<h4 id="deciding-on-channel-type">Deciding On Channel Type</h4>

<p>Both the FHIR specification and this guide rely on the definitions of a reduced set of channel types.  While the specification allows for additional channel type definitions, the included set attempts to cover the majority of common use cases.  Below is some guidance for implementers to consider when selecting a channel type.</p>

<h5 id="rest-hook">REST-Hook</h5>

<p>The FHIR standard makes extensive use of the RESTful model.  Given the popularity of REST and widespread adoption, most implementers should assume REST-hook as the ‘default’ channel type.  In general, REST-based systems are well-supported (e.g., tooling, infrastructure, documentation, etc.), and will present the lowest bar for implementation.</p>

<h5 id="websocket">Websocket</h5>

<p>Websockets are unique in the pre-defined channel types in being the only channel that does not require the client to have an endpoint.  Due to this property, the websocket channel is very useful for clients where creating an endpoint would be difficult or impossible (e.g., mobile clients, web-based clients, etc.).</p>

<h5 id="email">Email</h5>

<p>The Email channel is the only channel that could contest REST in non-FHIR implementations.  That said, Email communication is often high-latency and is typically used for communication to individuals - not applications.  Email channels are particularly useful in the context of these non-application use cases, such as public health notifications.  For example, if a public health agency does not have the ability or desire to build a custom RESTful solution (e.g., creating and maintaining an endpoint to receive notifications, as well as software to consume those notifications), it is straightforward to map notifications to email addresses or aliases.</p>

<h5 id="fhir-messaging">FHIR Messaging</h5>

<p>FHIR Messaging is a mechanism defined to allow for non-RESTful communication between FHIR servers and clients.  One common use case is when connectivity is an issue (e.g., remote sites that batch all communications when connections are available).  This channel defines how to integrate topic-based subscriptions with the FHIR Messaging model.</p>

<h5 id="custom-channels">Custom Channels</h5>

<p>For use cases that are not well-met by any of the predefined channels, the Subscriptions Framework allows for custom channel definitions.  Some examples of scenarios where custom channels may be applicable include:</p>
<ul>
  <li>requirements for reliable (guaranteed) delivery (e.g., message queues)</li>
  <li>implementations using other communication protocols (e.g., protocols specific to a cloud-based provider)</li>
  <li>implementations using a non-standard serialization format</li>
</ul>

<h4 id="rest-hook-1">REST-Hook</h4>

<p>To receive notifications via HTTP/S POST, a client should request a subscription with the channel type of <code class="language-plaintext highlighter-rouge">rest-hook</code> and set the endpoint to the appropriate client URL. Note that this URL must be accessible by the hosting server.</p>

<p>To convey an event notification, the server POSTs a <code class="language-plaintext highlighter-rouge">Bundle</code> to the client’s nominated endpoint URL per the format requests in the Subscription:</p>
<ul>
  <li>The <code class="language-plaintext highlighter-rouge">content-type</code> of the POST SHALL match the MIME type on the Subscription (<a href="http://hl7.org/fhir/subscription-definitions.html#Subscription.channel.payload">Subscription.channel.payload</a>).</li>
  <li>Each <a href="http://hl7.org/fhir/subscription-definitions.html#Subscription.channel.header">Subscription.header</a> value SHALL be conveyed as an HTTP request header.</li>
  <li>The bundle SHALL comply with the <a href="StructureDefinition-backport-subscription-notification.html">Backported R5 Notification Bundle Profile</a>.</li>
</ul>

<p>When a <code class="language-plaintext highlighter-rouge">Subscription</code> is created for a REST Hook channel type, the server SHALL set initial status to <code class="language-plaintext highlighter-rouge">requested</code>, pending verification of the nominated endpoint URL. After a successful <code class="language-plaintext highlighter-rouge">handshake</code> notification has been sent and accepted, the server SHALL update the status to <code class="language-plaintext highlighter-rouge">active</code>. Any errors in the initial <code class="language-plaintext highlighter-rouge">handshake</code> SHALL result in the status being changed to <code class="language-plaintext highlighter-rouge">error</code>.</p>

<p>An example workflow for establishing a <code>rest-hook</code> subscription is shown below.</p>

<figure>
    <!-- ?xml version="1.0" encoding="UTF-8" standalone="no"? --><svg contentStyleType="text/css" viewBox="0 0 736 959" zoomAndPan="magnify" preserveAspectRatio="none" width="736px" style="width:736px;height:959px;" contentScriptType="application/ecmascript" version="1.1" height="959px"><defs><filter width="300%" x="-1" y="-1" id="f1fxwe72bgtu5k" height="300%"><feGaussianBlur result="blurOut" stdDeviation="2.0"></feGaussianBlur><feColorMatrix result="blurOut2" in="blurOut" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0" type="matrix"></feColorMatrix><feOffset result="blurOut3" dx="4.0" dy="4.0" in="blurOut2"></feOffset><feBlend mode="normal" in="SourceGraphic" in2="blurOut3"></feBlend></filter></defs><g><rect filter="url(#f1fxwe72bgtu5k)" width="709.5" x="10" y="477.4951" style="stroke:#000000;stroke-width:2.0;" fill="#FFFFFF" height="399.2188"></rect><rect width="709.5" x="10" y="499.8467" style="stroke:none;stroke-width:1.0;" fill="#FFFFFF" height="188.4336"></rect><rect width="709.5" x="10" y="688.2803" style="stroke:none;stroke-width:1.0;" fill="#FFFFFF" height="188.4336"></rect><line y1="63.2188" x1="119" y2="656.2803" style="stroke:#A80036;stroke-width:1.0;" x2="119"></line><line y1="656.2803" x1="119" y2="688.2803" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x2="119"></line><line y1="688.2803" x1="119" y2="844.7139" style="stroke:#A80036;stroke-width:1.0;" x2="119"></line><line y1="844.7139" x1="119" y2="876.7139" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x2="119"></line><line y1="876.7139" x1="119" y2="893.7139" style="stroke:#A80036;stroke-width:1.0;" x2="119"></line><line y1="63.2188" x1="402.5" y2="656.2803" style="stroke:#A80036;stroke-width:1.0;" x2="402.5"></line><line y1="656.2803" x1="402.5" y2="688.2803" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x2="402.5"></line><line y1="688.2803" x1="402.5" y2="844.7139" style="stroke:#A80036;stroke-width:1.0;" x2="402.5"></line><line y1="844.7139" x1="402.5" y2="876.7139" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x2="402.5"></line><line y1="876.7139" x1="402.5" y2="893.7139" style="stroke:#A80036;stroke-width:1.0;" x2="402.5"></line><line y1="63.2188" x1="600.5" y2="656.2803" style="stroke:#A80036;stroke-width:1.0;" x2="600.5"></line><line y1="656.2803" x1="600.5" y2="688.2803" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x2="600.5"></line><line y1="688.2803" x1="600.5" y2="844.7139" style="stroke:#A80036;stroke-width:1.0;" x2="600.5"></line><line y1="844.7139" x1="600.5" y2="876.7139" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x2="600.5"></line><line y1="876.7139" x1="600.5" y2="893.7139" style="stroke:#A80036;stroke-width:1.0;" x2="600.5"></line><rect filter="url(#f1fxwe72bgtu5k)" width="95" x="70" y="5" style="stroke:#A80036;stroke-width:1.5;" fill="#FEFECE" height="53.2188"></rect><text lengthAdjust="spacing" x="79" font-size="14" textLength="77" y="28.5332" font-family="sans-serif" fill="#000000">FHIR Server</text><text lengthAdjust="spacing" x="86.5" font-size="14" textLength="62" y="46.1426" font-family="sans-serif" fill="#000000">REST API</text><rect filter="url(#f1fxwe72bgtu5k)" width="95" x="70" y="892.7139" style="stroke:#A80036;stroke-width:1.5;" fill="#FEFECE" height="53.2188"></rect><text lengthAdjust="spacing" x="79" font-size="14" textLength="77" y="916.2471" font-family="sans-serif" fill="#000000">FHIR Server</text><text lengthAdjust="spacing" x="86.5" font-size="14" textLength="62" y="933.8564" font-family="sans-serif" fill="#000000">REST API</text><rect filter="url(#f1fxwe72bgtu5k)" width="54" x="373.5" y="22.6094" style="stroke:#A80036;stroke-width:1.5;" fill="#FEFECE" height="35.6094"></rect><text lengthAdjust="spacing" x="382.5" font-size="14" textLength="36" y="46.1426" font-family="sans-serif" fill="#000000">Client</text><rect filter="url(#f1fxwe72bgtu5k)" width="54" x="373.5" y="892.7139" style="stroke:#A80036;stroke-width:1.5;" fill="#FEFECE" height="35.6094"></rect><text lengthAdjust="spacing" x="382.5" font-size="14" textLength="36" y="916.2471" font-family="sans-serif" fill="#000000">Client</text><rect filter="url(#f1fxwe72bgtu5k)" width="114" x="541.5" y="5" style="stroke:#A80036;stroke-width:1.5;" fill="#FEFECE" height="53.2188"></rect><text lengthAdjust="spacing" x="550.5" font-size="14" textLength="96" y="28.5332" font-family="sans-serif" fill="#000000">Client Endpoint</text><text lengthAdjust="spacing" x="569" font-size="14" textLength="59" y="46.1426" font-family="sans-serif" fill="#000000">(HTTP/S)</text><rect filter="url(#f1fxwe72bgtu5k)" width="114" x="541.5" y="892.7139" style="stroke:#A80036;stroke-width:1.5;" fill="#FEFECE" height="53.2188"></rect><text lengthAdjust="spacing" x="550.5" font-size="14" textLength="96" y="916.2471" font-family="sans-serif" fill="#000000">Client Endpoint</text><text lengthAdjust="spacing" x="569" font-size="14" textLength="59" y="933.8564" font-family="sans-serif" fill="#000000">(HTTP/S)</text><rect filter="url(#f1fxwe72bgtu5k)" width="729.5" x="0" y="96.3945" style="stroke:#EEEEEE;stroke-width:1.0;" fill="#EEEEEE" height="3"></rect><line y1="96.3945" x1="0" y2="96.3945" style="stroke:#000000;stroke-width:1.0;" x2="729.5"></line><line y1="99.3945" x1="0" y2="99.3945" style="stroke:#000000;stroke-width:1.0;" x2="729.5"></line><rect filter="url(#f1fxwe72bgtu5k)" width="190" x="269.75" y="83.2188" style="stroke:#000000;stroke-width:2.0;" fill="#EEEEEE" height="28.3516"></rect><text font-weight="bold" lengthAdjust="spacing" x="277.75" font-size="13" textLength="168" y="102.7139" font-family="sans-serif" fill="#000000">Negotiating a Subscription</text><line y1="164.8955" x1="119.5" y2="160.8955" style="stroke:#A80036;stroke-width:1.0;" x2="129.5"></line><line y1="164.8955" x1="119.5" y2="168.8955" style="stroke:#A80036;stroke-width:1.0;" x2="129.5"></line><line y1="164.8955" x1="119.5" y2="164.8955" style="stroke:#A80036;stroke-width:1.0;" x2="401.5"></line><text font-weight="bold" lengthAdjust="spacing" x="138.5" font-size="13" textLength="7" y="149.5522" font-family="sans-serif" fill="#000000">1</text><text lengthAdjust="spacing" x="153.5" font-size="13" textLength="114" y="141.0654" font-family="sans-serif" fill="#000000">Create Subscription</text><text lengthAdjust="spacing" x="153.5" font-size="13" textLength="176" y="156.9917" font-family="monospace" fill="#000000">channelType:&nbsp;rest-hook</text><line y1="216.2207" x1="400.5" y2="212.2207" style="stroke:#A80036;stroke-width:1.0;" x2="390.5"></line><line y1="216.2207" x1="400.5" y2="220.2207" style="stroke:#A80036;stroke-width:1.0;" x2="390.5"></line><line y1="216.2207" x1="119.5" y2="216.2207" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x2="401.5"></line><text font-weight="bold" lengthAdjust="spacing" x="128.5" font-size="13" textLength="7" y="200.8774" font-family="sans-serif" fill="#000000">2</text><text lengthAdjust="spacing" x="143.5" font-size="13" textLength="51" y="192.3906" font-family="sans-serif" fill="#000000">Success</text><text lengthAdjust="spacing" x="143.5" font-size="13" textLength="240" y="208.3169" font-family="monospace" fill="#000000">Subscription.status:&nbsp;requested</text><line y1="301.4932" x1="598.5" y2="297.4932" style="stroke:#A80036;stroke-width:1.0;" x2="588.5"></line><line y1="301.4932" x1="598.5" y2="305.4932" style="stroke:#A80036;stroke-width:1.0;" x2="588.5"></line><line y1="301.4932" x1="119.5" y2="301.4932" style="stroke:#A80036;stroke-width:1.0;" x2="599.5"></line><text font-weight="bold" lengthAdjust="spacing" x="128.5" font-size="13" textLength="7" y="269.1763" font-family="sans-serif" fill="#000000">3</text><text lengthAdjust="spacing" x="143.5" font-size="13" textLength="148" y="243.7158" font-family="sans-serif" fill="#000000">HTTP POST - Handshake</text><text lengthAdjust="spacing" x="143.5" font-size="13" textLength="56" y="259.6421" font-family="monospace" fill="#000000">Bundle:</text><text lengthAdjust="spacing" x="239.5" font-size="13" textLength="160" y="276.6157" font-family="monospace" fill="#000000">Bundle.type:&nbsp;history</text><text lengthAdjust="spacing" x="143.5" font-size="13" textLength="272" y="293.5894" font-family="monospace" fill="#000000">SubscriptionStatus.type:&nbsp;handshake</text><line y1="352.8184" x1="119.5" y2="348.8184" style="stroke:#A80036;stroke-width:1.0;" x2="129.5"></line><line y1="352.8184" x1="119.5" y2="356.8184" style="stroke:#A80036;stroke-width:1.0;" x2="129.5"></line><line y1="352.8184" x1="119.5" y2="352.8184" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x2="599.5"></line><text font-weight="bold" lengthAdjust="spacing" x="138.5" font-size="13" textLength="7" y="337.4751" font-family="sans-serif" fill="#000000">4</text><text lengthAdjust="spacing" x="153.5" font-size="13" textLength="121" y="328.9883" font-family="sans-serif" fill="#000000">HTTP Success, e.g.:</text><text lengthAdjust="spacing" x="153.5" font-size="13" textLength="56" y="344.9146" font-family="monospace" fill="#000000">200:&nbsp;OK</text><path filter="url(#f1fxwe72bgtu5k)" d="M124,365.8184 L124,412.8184 L365,412.8184 L365,375.8184 L355,365.8184 L124,365.8184 " style="stroke:#A80036;stroke-width:1.0;" fill="#FBFB77"></path><path d="M355,365.8184 L355,375.8184 L365,375.8184 L355,365.8184 " style="stroke:#A80036;stroke-width:1.0;" fill="#FBFB77"></path><text lengthAdjust="spacing" x="132" font-size="13" textLength="166" y="386.3135" font-family="sans-serif" fill="#000000">Server updates Subscription:</text><text lengthAdjust="spacing" x="132" font-size="13" textLength="216" y="402.2397" font-family="monospace" fill="#000000">Subscription.status:&nbsp;active</text><rect filter="url(#f1fxwe72bgtu5k)" width="729.5" x="0" y="445.3193" style="stroke:#EEEEEE;stroke-width:1.0;" fill="#EEEEEE" height="3"></rect><line y1="445.3193" x1="0" y2="445.3193" style="stroke:#000000;stroke-width:1.0;" x2="729.5"></line><line y1="448.3193" x1="0" y2="448.3193" style="stroke:#000000;stroke-width:1.0;" x2="729.5"></line><rect filter="url(#f1fxwe72bgtu5k)" width="232" x="248.75" y="432.1436" style="stroke:#000000;stroke-width:2.0;" fill="#EEEEEE" height="28.3516"></rect><text font-weight="bold" lengthAdjust="spacing" x="256.75" font-size="13" textLength="210" y="451.6387" font-family="sans-serif" fill="#000000">Sending / Receiving Notifications</text><path d="M10,477.4951 L166,477.4951 L166,489.4951 L156,499.4951 L10,499.4951 L10,477.4951 " style="stroke:#000000;stroke-width:1.0;" fill="#EEEEEE"></path><rect width="709.5" x="10" y="477.4951" style="stroke:#000000;stroke-width:2.0;" fill="none" height="399.2188"></rect><text font-weight="bold" lengthAdjust="spacing" x="27" font-size="13" textLength="107" y="493.9902" font-family="sans-serif" fill="#000000">REST Processing</text><line y1="500.8467" x1="10" y2="500.8467" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x2="719.5"></line><text font-weight="bold" lengthAdjust="spacing" x="17" font-size="11" textLength="105" y="514.2656" font-family="sans-serif" fill="#000000">[Bundle: heartbeat]</text><line y1="596.9551" x1="598.5" y2="592.9551" style="stroke:#A80036;stroke-width:1.0;" x2="588.5"></line><line y1="596.9551" x1="598.5" y2="600.9551" style="stroke:#A80036;stroke-width:1.0;" x2="588.5"></line><line y1="596.9551" x1="119.5" y2="596.9551" style="stroke:#A80036;stroke-width:1.0;" x2="599.5"></line><text font-weight="bold" lengthAdjust="spacing" x="128.5" font-size="13" textLength="7" y="564.6382" font-family="sans-serif" fill="#000000">5</text><text lengthAdjust="spacing" x="143.5" font-size="13" textLength="139" y="539.1777" font-family="sans-serif" fill="#000000">HTTP POST - Heartbeat</text><text lengthAdjust="spacing" x="143.5" font-size="13" textLength="56" y="555.104" font-family="monospace" fill="#000000">Bundle:</text><text lengthAdjust="spacing" x="239.5" font-size="13" textLength="160" y="572.0776" font-family="monospace" fill="#000000">Bundle.type:&nbsp;history</text><text lengthAdjust="spacing" x="143.5" font-size="13" textLength="272" y="589.0513" font-family="monospace" fill="#000000">SubscriptionStatus.type:&nbsp;heartbeat</text><line y1="648.2803" x1="119.5" y2="644.2803" style="stroke:#A80036;stroke-width:1.0;" x2="129.5"></line><line y1="648.2803" x1="119.5" y2="652.2803" style="stroke:#A80036;stroke-width:1.0;" x2="129.5"></line><line y1="648.2803" x1="119.5" y2="648.2803" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x2="599.5"></line><text font-weight="bold" lengthAdjust="spacing" x="138.5" font-size="13" textLength="7" y="632.937" font-family="sans-serif" fill="#000000">6</text><text lengthAdjust="spacing" x="153.5" font-size="13" textLength="121" y="624.4502" font-family="sans-serif" fill="#000000">HTTP Success, e.g.:</text><text lengthAdjust="spacing" x="153.5" font-size="13" textLength="56" y="640.3765" font-family="monospace" fill="#000000">200:&nbsp;OK</text><line y1="689.2803" x1="10" y2="689.2803" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x2="719.5"></line><text font-weight="bold" lengthAdjust="spacing" x="17" font-size="11" textLength="148" y="702.6992" font-family="sans-serif" fill="#000000">[Bundle: event-notification]</text><line y1="785.3887" x1="598.5" y2="781.3887" style="stroke:#A80036;stroke-width:1.0;" x2="588.5"></line><line y1="785.3887" x1="598.5" y2="789.3887" style="stroke:#A80036;stroke-width:1.0;" x2="588.5"></line><line y1="785.3887" x1="119.5" y2="785.3887" style="stroke:#A80036;stroke-width:1.0;" x2="599.5"></line><text font-weight="bold" lengthAdjust="spacing" x="128.5" font-size="13" textLength="7" y="753.0718" font-family="sans-serif" fill="#000000">7</text><text lengthAdjust="spacing" x="143.5" font-size="13" textLength="147" y="727.6113" font-family="sans-serif" fill="#000000">HTTP POST - Notification</text><text lengthAdjust="spacing" x="143.5" font-size="13" textLength="56" y="743.5376" font-family="monospace" fill="#000000">Bundle:</text><text lengthAdjust="spacing" x="239.5" font-size="13" textLength="160" y="760.5112" font-family="monospace" fill="#000000">Bundle.type:&nbsp;history</text><text lengthAdjust="spacing" x="143.5" font-size="13" textLength="344" y="777.4849" font-family="monospace" fill="#000000">SubscriptionStatus.type:&nbsp;event-notification</text><line y1="836.7139" x1="119.5" y2="832.7139" style="stroke:#A80036;stroke-width:1.0;" x2="129.5"></line><line y1="836.7139" x1="119.5" y2="840.7139" style="stroke:#A80036;stroke-width:1.0;" x2="129.5"></line><line y1="836.7139" x1="119.5" y2="836.7139" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x2="599.5"></line><text font-weight="bold" lengthAdjust="spacing" x="138.5" font-size="13" textLength="7" y="821.3706" font-family="sans-serif" fill="#000000">8</text><text lengthAdjust="spacing" x="153.5" font-size="13" textLength="121" y="812.8838" font-family="sans-serif" fill="#000000">HTTP Success, e.g.:</text><text lengthAdjust="spacing" x="153.5" font-size="13" textLength="56" y="828.8101" font-family="monospace" fill="#000000">200:&nbsp;OK</text></g></svg>
  <figcaption>Diagram showing a possible workflow for rest-hook subscriptions</figcaption>
</figure>

<ol>
  <li>Client creates a <code class="language-plaintext highlighter-rouge">Subscription</code> with the <code class="language-plaintext highlighter-rouge">channelType</code> set to <code class="language-plaintext highlighter-rouge">rest-hook</code>.</li>
  <li>Server responds with a success code and creates the subscription with a state of <code class="language-plaintext highlighter-rouge">requested</code>.</li>
  <li>Server performs an HTTP POST to the requested endpoint with a <code class="language-plaintext highlighter-rouge">handshake</code> notification.</li>
  <li>Client Endpoint accepts the POST and returns a success HTTP code (e.g., <code class="language-plaintext highlighter-rouge">200</code>).</li>
  <li>Server may send notifications of type <code class="language-plaintext highlighter-rouge">heartbeat</code> at any time.</li>
  <li>Endpoints should respond with appropriate HTTP status codes (e.g., <code class="language-plaintext highlighter-rouge">200</code>).</li>
  <li>Server may send notifications of type <code class="language-plaintext highlighter-rouge">event-notificaiton</code> at any time.</li>
  <li>Endpoints should respond with appropriate HTTP status codes (e.g., <code class="language-plaintext highlighter-rouge">200</code>).</li>
</ol>

<h5 id="security-notes">Security Notes</h5>

<p>HTTP is neither a secure nor an encrypted channel, nor does it provide endpoint verification. It is strongly recommended that implementations refuse requests to send notifications to URLs using the HTTP protocol (use HTTPS instead).</p>

<h4 id="websockets">Websockets</h4>

<p>While the primary interface for FHIR servers is the FHIR REST API, notifications need not occur via REST. Indeed, some subscribers may be unable to expose an outward-facing HTTP server to receive triggered notifications. For example, a pure client-side Web app or mobile app may want to subscribe to a data feed. This can be accomplished using a <code class="language-plaintext highlighter-rouge">websocket</code> notification channel.</p>

<p>A client can declare its intention to receive notifications via Web Sockets by requesting a subscription with the channel type of <code class="language-plaintext highlighter-rouge">websocket</code>.</p>

<p>An example workflow for receiving notifications via websockets is shown below:</p>

<figure>
    <!-- ?xml version="1.0" encoding="UTF-8" standalone="no"? --><svg contentStyleType="text/css" viewBox="0 0 1057 1293" zoomAndPan="magnify" preserveAspectRatio="none" width="1057px" style="width:1057px;height:1293px;" contentScriptType="application/ecmascript" version="1.1" height="1293px"><defs><filter width="300%" x="-1" y="-1" id="f4eixg0rrw8u5" height="300%"><feGaussianBlur result="blurOut" stdDeviation="2.0"></feGaussianBlur><feColorMatrix result="blurOut2" in="blurOut" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0" type="matrix"></feColorMatrix><feOffset result="blurOut3" dx="4.0" dy="4.0" in="blurOut2"></feOffset><feBlend mode="normal" in="SourceGraphic" in2="blurOut3"></feBlend></filter></defs><g><rect filter="url(#f4eixg0rrw8u5)" width="1030.5" x="10" y="570.7676" style="stroke:#000000;stroke-width:2.0;" fill="#FFFFFF" height="605.0303"></rect><rect width="1030.5" x="10" y="593.1191" style="stroke:none;stroke-width:1.0;" fill="#FFFFFF" height="120.1348"></rect><rect width="1030.5" x="10" y="713.2539" style="stroke:none;stroke-width:1.0;" fill="#FFFFFF" height="120.1348"></rect><rect width="1030.5" x="10" y="833.3887" style="stroke:none;stroke-width:1.0;" fill="#FFFFFF" height="342.4092"></rect><line y1="63.2188" x1="109" y2="681.2539" style="stroke:#A80036;stroke-width:1.0;" x2="109"></line><line y1="681.2539" x1="109" y2="713.2539" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x2="109"></line><line y1="713.2539" x1="109" y2="801.3887" style="stroke:#A80036;stroke-width:1.0;" x2="109"></line><line y1="801.3887" x1="109" y2="833.3887" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x2="109"></line><line y1="833.3887" x1="109" y2="1143.7979" style="stroke:#A80036;stroke-width:1.0;" x2="109"></line><line y1="1143.7979" x1="109" y2="1175.7979" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x2="109"></line><line y1="1175.7979" x1="109" y2="1227.1494" style="stroke:#A80036;stroke-width:1.0;" x2="109"></line><line y1="63.2188" x1="527.5" y2="681.2539" style="stroke:#A80036;stroke-width:1.0;" x2="527.5"></line><line y1="681.2539" x1="527.5" y2="713.2539" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x2="527.5"></line><line y1="713.2539" x1="527.5" y2="801.3887" style="stroke:#A80036;stroke-width:1.0;" x2="527.5"></line><line y1="801.3887" x1="527.5" y2="833.3887" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x2="527.5"></line><line y1="833.3887" x1="527.5" y2="1143.7979" style="stroke:#A80036;stroke-width:1.0;" x2="527.5"></line><line y1="1143.7979" x1="527.5" y2="1175.7979" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x2="527.5"></line><line y1="1175.7979" x1="527.5" y2="1227.1494" style="stroke:#A80036;stroke-width:1.0;" x2="527.5"></line><line y1="63.2188" x1="914.5" y2="681.2539" style="stroke:#A80036;stroke-width:1.0;" x2="914.5"></line><line y1="681.2539" x1="914.5" y2="713.2539" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x2="914.5"></line><line y1="713.2539" x1="914.5" y2="801.3887" style="stroke:#A80036;stroke-width:1.0;" x2="914.5"></line><line y1="801.3887" x1="914.5" y2="833.3887" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x2="914.5"></line><line y1="833.3887" x1="914.5" y2="1143.7979" style="stroke:#A80036;stroke-width:1.0;" x2="914.5"></line><line y1="1143.7979" x1="914.5" y2="1175.7979" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x2="914.5"></line><line y1="1175.7979" x1="914.5" y2="1227.1494" style="stroke:#A80036;stroke-width:1.0;" x2="914.5"></line><rect filter="url(#f4eixg0rrw8u5)" width="95" x="60" y="5" style="stroke:#A80036;stroke-width:1.5;" fill="#FEFECE" height="53.2188"></rect><text lengthAdjust="spacing" x="69" font-size="14" textLength="77" y="28.5332" font-family="sans-serif" fill="#000000">FHIR Server</text><text lengthAdjust="spacing" x="76.5" font-size="14" textLength="62" y="46.1426" font-family="sans-serif" fill="#000000">REST API</text><rect filter="url(#f4eixg0rrw8u5)" width="95" x="60" y="1226.1494" style="stroke:#A80036;stroke-width:1.5;" fill="#FEFECE" height="53.2188"></rect><text lengthAdjust="spacing" x="69" font-size="14" textLength="77" y="1249.6826" font-family="sans-serif" fill="#000000">FHIR Server</text><text lengthAdjust="spacing" x="76.5" font-size="14" textLength="62" y="1267.292" font-family="sans-serif" fill="#000000">REST API</text><rect filter="url(#f4eixg0rrw8u5)" width="54" x="498.5" y="22.6094" style="stroke:#A80036;stroke-width:1.5;" fill="#FEFECE" height="35.6094"></rect><text lengthAdjust="spacing" x="507.5" font-size="14" textLength="36" y="46.1426" font-family="sans-serif" fill="#000000">Client</text><rect filter="url(#f4eixg0rrw8u5)" width="54" x="498.5" y="1226.1494" style="stroke:#A80036;stroke-width:1.5;" fill="#FEFECE" height="35.6094"></rect><text lengthAdjust="spacing" x="507.5" font-size="14" textLength="36" y="1249.6826" font-family="sans-serif" fill="#000000">Client</text><rect filter="url(#f4eixg0rrw8u5)" width="148" x="838.5" y="5" style="stroke:#A80036;stroke-width:1.5;" fill="#FEFECE" height="53.2188"></rect><text lengthAdjust="spacing" x="874" font-size="14" textLength="77" y="28.5332" font-family="sans-serif" fill="#000000">FHIR Server</text><text lengthAdjust="spacing" x="847.5" font-size="14" textLength="130" y="46.1426" font-family="sans-serif" fill="#000000">Websocket Endpoint</text><rect filter="url(#f4eixg0rrw8u5)" width="148" x="838.5" y="1226.1494" style="stroke:#A80036;stroke-width:1.5;" fill="#FEFECE" height="53.2188"></rect><text lengthAdjust="spacing" x="874" font-size="14" textLength="77" y="1249.6826" font-family="sans-serif" fill="#000000">FHIR Server</text><text lengthAdjust="spacing" x="847.5" font-size="14" textLength="130" y="1267.292" font-family="sans-serif" fill="#000000">Websocket Endpoint</text><rect filter="url(#f4eixg0rrw8u5)" width="1050.5" x="0" y="96.3945" style="stroke:#EEEEEE;stroke-width:1.0;" fill="#EEEEEE" height="3"></rect><line y1="96.3945" x1="0" y2="96.3945" style="stroke:#000000;stroke-width:1.0;" x2="1050.5"></line><line y1="99.3945" x1="0" y2="99.3945" style="stroke:#000000;stroke-width:1.0;" x2="1050.5"></line><rect filter="url(#f4eixg0rrw8u5)" width="190" x="430.25" y="83.2188" style="stroke:#000000;stroke-width:2.0;" fill="#EEEEEE" height="28.3516"></rect><text font-weight="bold" lengthAdjust="spacing" x="438.25" font-size="13" textLength="168" y="102.7139" font-family="sans-serif" fill="#000000">Negotiating a Subscription</text><polygon style="stroke:#A80036;stroke-width:1.0;" fill="#A80036" points="120.5,160.8955,110.5,164.8955,120.5,168.8955,116.5,164.8955"></polygon><line y1="164.8955" x1="114.5" y2="164.8955" style="stroke:#A80036;stroke-width:1.0;" x2="526.5"></line><text font-weight="bold" lengthAdjust="spacing" x="128.5" font-size="13" textLength="7" y="149.5522" font-family="sans-serif" fill="#000000">1</text><text lengthAdjust="spacing" x="143.5" font-size="13" textLength="114" y="141.0654" font-family="sans-serif" fill="#000000">Create Subscription</text><text lengthAdjust="spacing" x="143.5" font-size="13" textLength="176" y="156.9917" font-family="monospace" fill="#000000">channelType:&nbsp;websocket</text><polygon style="stroke:#A80036;stroke-width:1.0;" fill="#A80036" points="515.5,212.2207,525.5,216.2207,515.5,220.2207,519.5,216.2207"></polygon><line y1="216.2207" x1="109.5" y2="216.2207" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x2="521.5"></line><text font-weight="bold" lengthAdjust="spacing" x="118.5" font-size="13" textLength="7" y="200.8774" font-family="sans-serif" fill="#000000">2</text><text lengthAdjust="spacing" x="133.5" font-size="13" textLength="51" y="192.3906" font-family="sans-serif" fill="#000000">Success</text><text lengthAdjust="spacing" x="133.5" font-size="13" textLength="216" y="208.3169" font-family="monospace" fill="#000000">Subscription.status:&nbsp;active</text><rect filter="url(#f4eixg0rrw8u5)" width="1050.5" x="0" y="247.3965" style="stroke:#EEEEEE;stroke-width:1.0;" fill="#EEEEEE" height="3"></rect><line y1="247.3965" x1="0" y2="247.3965" style="stroke:#000000;stroke-width:1.0;" x2="1050.5"></line><line y1="250.3965" x1="0" y2="250.3965" style="stroke:#000000;stroke-width:1.0;" x2="1050.5"></line><rect filter="url(#f4eixg0rrw8u5)" width="144" x="453.25" y="234.2207" style="stroke:#000000;stroke-width:2.0;" fill="#EEEEEE" height="28.3516"></rect><text font-weight="bold" lengthAdjust="spacing" x="461.25" font-size="13" textLength="122" y="253.7158" font-family="sans-serif" fill="#000000">Websocket Session</text><polygon style="stroke:#A80036;stroke-width:1.0;" fill="#A80036" points="120.5,311.8975,110.5,315.8975,120.5,319.8975,116.5,315.8975"></polygon><line y1="315.8975" x1="114.5" y2="315.8975" style="stroke:#A80036;stroke-width:1.0;" x2="526.5"></line><text font-weight="bold" lengthAdjust="spacing" x="128.5" font-size="13" textLength="7" y="300.5542" font-family="sans-serif" fill="#000000">3</text><text lengthAdjust="spacing" x="143.5" font-size="13" textLength="93" y="292.0674" font-family="sans-serif" fill="#000000">FHIR Operation:</text><text lengthAdjust="spacing" x="143.5" font-size="13" textLength="368" y="307.9937" font-family="monospace" fill="#000000">.../Subscription/example/$get-ws-binding-token</text><polygon style="stroke:#A80036;stroke-width:1.0;" fill="#A80036" points="515.5,397.1699,525.5,401.1699,515.5,405.1699,519.5,401.1699"></polygon><line y1="401.1699" x1="109.5" y2="401.1699" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x2="521.5"></line><text font-weight="bold" lengthAdjust="spacing" x="118.5" font-size="13" textLength="7" y="368.853" font-family="sans-serif" fill="#000000">4</text><text lengthAdjust="spacing" x="133.5" font-size="13" textLength="104" y="343.3926" font-family="sans-serif" fill="#000000">FHIR Parameters:</text><text lengthAdjust="spacing" x="197.5" font-size="13" textLength="128" y="359.3188" font-family="monospace" fill="#000000">token:&nbsp;token-abc</text><text lengthAdjust="spacing" x="157.5" font-size="13" textLength="264" y="376.2925" font-family="monospace" fill="#000000">expiration:&nbsp;some-future-date-time</text><text lengthAdjust="spacing" x="133.5" font-size="13" textLength="328" y="393.2661" font-family="monospace" fill="#000000">websocket-url:&nbsp;wss://example.org/fhirR4ws</text><polygon style="stroke:#A80036;stroke-width:1.0;" fill="#A80036" points="902.5,448.4951,912.5,452.4951,902.5,456.4951,906.5,452.4951"></polygon><line y1="452.4951" x1="527.5" y2="452.4951" style="stroke:#A80036;stroke-width:1.0;" x2="908.5"></line><text font-weight="bold" lengthAdjust="spacing" x="536.5" font-size="13" textLength="7" y="437.1519" font-family="sans-serif" fill="#000000">5</text><text lengthAdjust="spacing" x="551.5" font-size="13" textLength="48" y="428.665" font-family="sans-serif" fill="#000000">Connect</text><text lengthAdjust="spacing" x="551.5" font-size="13" textLength="208" y="444.5913" font-family="monospace" fill="#000000">wss://example.org/fhirR4ws</text><polygon style="stroke:#A80036;stroke-width:1.0;" fill="#A80036" points="902.5,483.4688,912.5,487.4688,902.5,491.4688,906.5,487.4688"></polygon><line y1="487.4688" x1="527.5" y2="487.4688" style="stroke:#A80036;stroke-width:1.0;" x2="908.5"></line><text font-weight="bold" lengthAdjust="spacing" x="536.5" font-size="13" textLength="7" y="480.3013" font-family="sans-serif" fill="#000000">6</text><text lengthAdjust="spacing" x="551.5" font-size="13" textLength="208" y="479.5649" font-family="monospace" fill="#000000">bind-with-token:&nbsp;token-abc</text><polygon style="stroke:#A80036;stroke-width:1.0;" fill="#A80036" points="538.5,551.7676,528.5,555.7676,538.5,559.7676,534.5,555.7676"></polygon><line y1="555.7676" x1="532.5" y2="555.7676" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x2="913.5"></line><text font-weight="bold" lengthAdjust="spacing" x="546.5" font-size="13" textLength="7" y="531.9375" font-family="sans-serif" fill="#000000">7</text><text lengthAdjust="spacing" x="561.5" font-size="13" textLength="44" y="514.9639" font-family="sans-serif" fill="#000000">Bundle:</text><text lengthAdjust="spacing" x="657.5" font-size="13" textLength="160" y="530.8901" font-family="monospace" fill="#000000">Bundle.type:&nbsp;history</text><text lengthAdjust="spacing" x="561.5" font-size="13" textLength="272" y="547.8638" font-family="monospace" fill="#000000">SubscriptionStatus.type:&nbsp;handshake</text><path d="M10,570.7676 L201,570.7676 L201,582.7676 L191,592.7676 L10,592.7676 L10,570.7676 " style="stroke:#000000;stroke-width:1.0;" fill="#EEEEEE"></path><rect width="1030.5" x="10" y="570.7676" style="stroke:#000000;stroke-width:2.0;" fill="none" height="605.0303"></rect><text font-weight="bold" lengthAdjust="spacing" x="27" font-size="13" textLength="142" y="587.2627" font-family="sans-serif" fill="#000000">Websocket Processing</text><line y1="594.1191" x1="10" y2="594.1191" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x2="1040.5"></line><text font-weight="bold" lengthAdjust="spacing" x="17" font-size="11" textLength="105" y="607.5381" font-family="sans-serif" fill="#000000">[Bundle: heartbeat]</text><polygon style="stroke:#A80036;stroke-width:1.0;" fill="#A80036" points="538.5,669.2539,528.5,673.2539,538.5,677.2539,534.5,673.2539"></polygon><line y1="673.2539" x1="532.5" y2="673.2539" style="stroke:#A80036;stroke-width:1.0;" x2="913.5"></line><text font-weight="bold" lengthAdjust="spacing" x="546.5" font-size="13" textLength="7" y="649.4238" font-family="sans-serif" fill="#000000">8</text><text lengthAdjust="spacing" x="561.5" font-size="13" textLength="44" y="632.4502" font-family="sans-serif" fill="#000000">Bundle:</text><text lengthAdjust="spacing" x="657.5" font-size="13" textLength="160" y="648.3765" font-family="monospace" fill="#000000">Bundle.type:&nbsp;history</text><text lengthAdjust="spacing" x="561.5" font-size="13" textLength="272" y="665.3501" font-family="monospace" fill="#000000">SubscriptionStatus.type:&nbsp;heartbeat</text><line y1="714.2539" x1="10" y2="714.2539" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x2="1040.5"></line><text font-weight="bold" lengthAdjust="spacing" x="17" font-size="11" textLength="148" y="727.6729" font-family="sans-serif" fill="#000000">[Bundle: event-notification]</text><polygon style="stroke:#A80036;stroke-width:1.0;" fill="#A80036" points="538.5,789.3887,528.5,793.3887,538.5,797.3887,534.5,793.3887"></polygon><line y1="793.3887" x1="532.5" y2="793.3887" style="stroke:#A80036;stroke-width:1.0;" x2="913.5"></line><text font-weight="bold" lengthAdjust="spacing" x="546.5" font-size="13" textLength="7" y="769.5586" font-family="sans-serif" fill="#000000">9</text><text lengthAdjust="spacing" x="561.5" font-size="13" textLength="44" y="752.585" font-family="sans-serif" fill="#000000">Bundle:</text><text lengthAdjust="spacing" x="657.5" font-size="13" textLength="160" y="768.5112" font-family="monospace" fill="#000000">Bundle.type:&nbsp;history</text><text lengthAdjust="spacing" x="561.5" font-size="13" textLength="344" y="785.4849" font-family="monospace" fill="#000000">SubscriptionStatus.type:&nbsp;event-notification</text><line y1="834.3887" x1="10" y2="834.3887" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x2="1040.5"></line><text font-weight="bold" lengthAdjust="spacing" x="17" font-size="11" textLength="135" y="847.8076" font-family="sans-serif" fill="#000000">[Token is expiring soon]</text><polygon style="stroke:#A80036;stroke-width:1.0;" fill="#A80036" points="120.5,892.5498,110.5,896.5498,120.5,900.5498,116.5,896.5498"></polygon><line y1="896.5498" x1="114.5" y2="896.5498" style="stroke:#A80036;stroke-width:1.0;" x2="526.5"></line><text font-weight="bold" lengthAdjust="spacing" x="128.5" font-size="13" textLength="14" y="881.2065" font-family="sans-serif" fill="#000000">10</text><text lengthAdjust="spacing" x="150.5" font-size="13" textLength="93" y="872.7197" font-family="sans-serif" fill="#000000">FHIR Operation:</text><text lengthAdjust="spacing" x="150.5" font-size="13" textLength="368" y="888.646" font-family="monospace" fill="#000000">.../Subscription/example/$get-ws-binding-token</text><polygon style="stroke:#A80036;stroke-width:1.0;" fill="#A80036" points="515.5,977.8223,525.5,981.8223,515.5,985.8223,519.5,981.8223"></polygon><line y1="981.8223" x1="109.5" y2="981.8223" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x2="521.5"></line><text font-weight="bold" lengthAdjust="spacing" x="118.5" font-size="13" textLength="14" y="949.5054" font-family="sans-serif" fill="#000000">11</text><text lengthAdjust="spacing" x="140.5" font-size="13" textLength="104" y="924.0449" font-family="sans-serif" fill="#000000">FHIR Parameters:</text><text lengthAdjust="spacing" x="204.5" font-size="13" textLength="128" y="939.9712" font-family="monospace" fill="#000000">token:&nbsp;token-def</text><text lengthAdjust="spacing" x="164.5" font-size="13" textLength="288" y="956.9448" font-family="monospace" fill="#000000">expiration:&nbsp;another-future-date-time</text><text lengthAdjust="spacing" x="140.5" font-size="13" textLength="328" y="973.9185" font-family="monospace" fill="#000000">websocket-url:&nbsp;wss://example.org/fhirR4ws</text><ellipse cx="527" cy="1031.7754" rx="4" ry="4" style="stroke:#A80036;stroke-width:1.5;" fill="none"></ellipse><ellipse cx="914" cy="1031.7754" rx="4" ry="4" style="stroke:#A80036;stroke-width:1.5;" fill="none"></ellipse><polygon style="stroke:#A80036;stroke-width:1.0;" fill="#A80036" points="897,1028.5254,907,1032.5254,897,1036.5254,901,1032.5254"></polygon><line y1="1032.5254" x1="531.5" y2="1032.5254" style="stroke:#A80036;stroke-width:1.0;" x2="903"></line><text font-weight="bold" lengthAdjust="spacing" x="536.5" font-size="13" textLength="14" y="1017.4932" font-family="sans-serif" fill="#000000">12</text><text lengthAdjust="spacing" x="558.5" font-size="13" textLength="214" y="1009.3174" font-family="sans-serif" fill="#000000">Client checks the url and establishes</text><text lengthAdjust="spacing" x="558.5" font-size="13" textLength="175" y="1025.6689" font-family="sans-serif" fill="#000000">a new connection if necessary</text><polygon style="stroke:#A80036;stroke-width:1.0;" fill="#A80036" points="902.5,1063.499,912.5,1067.499,902.5,1071.499,906.5,1067.499"></polygon><line y1="1067.499" x1="527.5" y2="1067.499" style="stroke:#A80036;stroke-width:1.0;" x2="908.5"></line><text font-weight="bold" lengthAdjust="spacing" x="536.5" font-size="13" textLength="14" y="1060.3315" font-family="sans-serif" fill="#000000">13</text><text lengthAdjust="spacing" x="558.5" font-size="13" textLength="208" y="1059.5952" font-family="monospace" fill="#000000">bind-with-token:&nbsp;token-def</text><polygon style="stroke:#A80036;stroke-width:1.0;" fill="#A80036" points="538.5,1131.7979,528.5,1135.7979,538.5,1139.7979,534.5,1135.7979"></polygon><line y1="1135.7979" x1="532.5" y2="1135.7979" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x2="913.5"></line><text font-weight="bold" lengthAdjust="spacing" x="546.5" font-size="13" textLength="14" y="1111.9678" font-family="sans-serif" fill="#000000">14</text><text lengthAdjust="spacing" x="568.5" font-size="13" textLength="44" y="1094.9941" font-family="sans-serif" fill="#000000">Bundle:</text><text lengthAdjust="spacing" x="664.5" font-size="13" textLength="160" y="1110.9204" font-family="monospace" fill="#000000">Bundle.type:&nbsp;history</text><text lengthAdjust="spacing" x="568.5" font-size="13" textLength="272" y="1127.894" font-family="monospace" fill="#000000">SubscriptionStatus.type:&nbsp;handshake</text><line y1="1204.1494" x1="533.5" y2="1214.1494" style="stroke:#A80036;stroke-width:2.0;" x2="543.5"></line><line y1="1214.1494" x1="533.5" y2="1204.1494" style="stroke:#A80036;stroke-width:2.0;" x2="543.5"></line><line y1="1204.1494" x1="896.5" y2="1214.1494" style="stroke:#A80036;stroke-width:2.0;" x2="906.5"></line><line y1="1214.1494" x1="896.5" y2="1204.1494" style="stroke:#A80036;stroke-width:2.0;" x2="906.5"></line><line y1="1209.1494" x1="539.5" y2="1209.1494" style="stroke:#A80036;stroke-width:1.0;" x2="901.5"></line><text font-weight="bold" lengthAdjust="spacing" x="546.5" font-size="13" textLength="14" y="1202.293" font-family="sans-serif" fill="#000000">15</text><text lengthAdjust="spacing" x="568.5" font-size="13" textLength="65" y="1202.293" font-family="sans-serif" fill="#000000">Disconnect</text></g></svg>
  <figcaption>Diagram showing a possible workflow for websocket subscriptions</figcaption>
</figure>

<ol>
  <li>Client creates a Subscription with the <code class="language-plaintext highlighter-rouge">channelType</code> set to <code class="language-plaintext highlighter-rouge">websocket</code>.</li>
  <li>Server responds with a success code and creates the subscription.</li>
  <li>Client requests a websocket binding token, by invoking the <code class="language-plaintext highlighter-rouge">$get-ws-binding-token</code> operation via REST. Note: this call is intended to be repeated as necessary (e.g., prior to a token expiring, a client should request a new one).</li>
  <li>Server returns <code class="language-plaintext highlighter-rouge">Parameters</code> with a <code class="language-plaintext highlighter-rouge">token</code>,<code class="language-plaintext highlighter-rouge">expiration</code>, and <code class="language-plaintext highlighter-rouge">websocket-url</code>.</li>
  <li>Client connects to the server via websockets, via the returned <code class="language-plaintext highlighter-rouge">websocket-url</code> (<code class="language-plaintext highlighter-rouge">wss://</code> preferred).</li>
  <li>Client sends a <code class="language-plaintext highlighter-rouge">bind-with-token</code> message via websockets, with the token provided by the server. Note: this operation can be repeated concurrently for multiple subscriptions, and serially for continued operation over a single websocket connection.</li>
  <li>Server sends one or more <code class="language-plaintext highlighter-rouge">handshake</code> messages via websockets (one per Subscription included in the token). Note: some servers may additionally send one or more <code class="language-plaintext highlighter-rouge">event-notification</code> messages at this time (e.g., all messages since last connected, last ‘n’ messages, etc.). Clients are expected to handle either flow.</li>
  <li>Server may send notifications of type <code class="language-plaintext highlighter-rouge">heartbeat</code> at any time.</li>
  <li>Server may send notifications of type <code class="language-plaintext highlighter-rouge">event-notification</code> at any time.</li>
  <li>If the token is expiring soon and the Client wishes to continue receiving notifications, it should invoke the <code class="language-plaintext highlighter-rouge">$get-ws-binding-token</code> operation via REST.</li>
  <li>Server returns <code class="language-plaintext highlighter-rouge">Parameters</code> with a new <code class="language-plaintext highlighter-rouge">token</code>, <code class="language-plaintext highlighter-rouge">expiration</code>, and <code class="language-plaintext highlighter-rouge">websocket-url</code>.</li>
  <li>If the <code class="language-plaintext highlighter-rouge">websocket-url</code> is different from the existing connection, the Client establishes a new connection to the Client Endpoint.</li>
  <li>Client sends a <code class="language-plaintext highlighter-rouge">bind-with-token</code> message via websockets, with the token provided by the server. Note: this operation can be repeated concurrently for multiple subscriptions, and serially for continued operation over a single websocket connection.</li>
  <li>Server sends one or more <code class="language-plaintext highlighter-rouge">handshake</code> messages via websockets (one per Subscription included in the token). Note: some servers may additionally send one or more <code class="language-plaintext highlighter-rouge">event-notification</code> messages at this time (e.g., all messages since last connected, last ‘n’ messages, etc.). Clients are expected to handle either flow.</li>
  <li>Either the server or the client may close the websocket connection.</li>
</ol>

<p>Note: all notifications sent from the server SHALL be in the MIME type specified by the Subscription (<a href="http://hl7.org/fhir/subscription-definitions.html#Subscription.channel.payload">Subscription.channel.payload</a>).</p>

<h5 id="security-notes-1">Security Notes</h5>

<p>WebSocket security poses several challenges specific to the channel. When implementing websockets for notifications, please keep in mind the following list of some areas of concern:</p>

<ul>
  <li>Authentication of WebSockets is not generically interoperable with JWT or other ‘Authentication header’ protocols - WS and WSS do NOT allow for the required headers.</li>
  <li>Given client limitations on concurrent WebSocket connections (commonly 6), it is recommended that a single connection be able to authenticate to multiple Subscription resources.</li>
  <li>Unlike HTTP/S requests, WebSockets can be long-lived. Because of this, the case of revoking access of an active connection must be considered.</li>
</ul>

<h4 id="email-1">Email</h4>

<p>While the primary interface for FHIR servers is the FHIR REST API, notifications need not occur via REST. Indeed, some subscribers may be unable to maintain an outward-facing HTTP server to receive triggered notifications. For example, a public health organization may want to be notified of outbreaks of various illnesses. This can be accomplished using an <code class="language-plaintext highlighter-rouge">email</code> notification channel.</p>

<p>A client can declare its intention to receive notifications via Email by requesting a subscription with the channel type of <code class="language-plaintext highlighter-rouge">email</code> and setting the endpoint to the appropriate email URI (e.g., <code class="language-plaintext highlighter-rouge">mailto:public_health_notifications@example.org</code>).</p>

<p>The server will send a new message each time a notification should be sent (e.g., per event or per batch). The server will create a message based on the values present in the <a href="http://hl7.org/fhir/subscription-definitions.html#Subscription.channel.payload">Subscription.channel.payload</a> and <a href="StructureDefinition-backport-payload-content.html">payload content</a> fields. If a server cannot honor the requested combination, the server SHOULD reject the Subscription request rather than send unexpected email messages.</p>

<p>The email channel sets two guidelines about content:</p>

<ul>
  <li>Message Body content SHALL be human readable</li>
  <li>Message Attachments SHOULD be machine readable</li>
</ul>

<p>Due to these guidelines, the <a href="http://hl7.org/fhir/subscription-definitions.html#Subscription.channel.payload">Subscription.channel.payload</a> refers to the content of the body of the message. Attachment type information can be appended as a MIME parameter, for example:</p>

<ul>
  <li>text/plain: a plain-text body with no attachment</li>
  <li>text/html: an HTML body with no attachment</li>
  <li>text/plain;attach=application/fhir+json: a plain-text body with a FHIR JSON bundle attached</li>
  <li>text/html;attach=application/fhir+xml: an HTML body with a FHIR XML bundle attached</li>
</ul>

<p>The <a href="StructureDefinition-backport-payload-content.html">payload content</a> field SHALL be applied to any attachments and MAY be applied to body contents (depending on server implementation). However, a server must not include a body which exceeds the specified content level. For example, a server may choose to always include a standard message in the body of the message containing no PHI and vary the attachment, but cannot include PHI in the body of an email when the content is set to <code class="language-plaintext highlighter-rouge">empty</code>.</p>

<p>An example workflow for receiving notifications via email is shown below:</p>

<figure>
    <!-- ?xml version="1.0" encoding="UTF-8" standalone="no"? --><svg contentStyleType="text/css" viewBox="0 0 703 828" zoomAndPan="magnify" preserveAspectRatio="none" width="703px" style="width:703px;height:828px;" contentScriptType="application/ecmascript" version="1.1" height="828px"><defs><filter width="300%" x="-1" y="-1" id="f1n8bfz5kk7rs7" height="300%"><feGaussianBlur result="blurOut" stdDeviation="2.0"></feGaussianBlur><feColorMatrix result="blurOut2" in="blurOut" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0" type="matrix"></feColorMatrix><feOffset result="blurOut3" dx="4.0" dy="4.0" in="blurOut2"></feOffset><feBlend mode="normal" in="SourceGraphic" in2="blurOut3"></feBlend></filter></defs><g><rect filter="url(#f1n8bfz5kk7rs7)" width="679.5" x="10" y="80.2188" style="stroke:#000000;stroke-width:2.0;" fill="#FFFFFF" height="388.001"></rect><rect width="679.5" x="10" y="153.8955" style="stroke:none;stroke-width:1.0;" fill="#FFFFFF" height="96.1611"></rect><rect width="679.5" x="10" y="250.0566" style="stroke:none;stroke-width:1.0;" fill="#FFFFFF" height="218.1631"></rect><rect filter="url(#f1n8bfz5kk7rs7)" width="679.5" x="10" y="482.2197" style="stroke:#000000;stroke-width:2.0;" fill="#FFFFFF" height="262.6211"></rect><rect width="679.5" x="10" y="504.5713" style="stroke:none;stroke-width:1.0;" fill="#FFFFFF" height="120.1348"></rect><rect width="679.5" x="10" y="624.7061" style="stroke:none;stroke-width:1.0;" fill="#FFFFFF" height="120.1348"></rect><line y1="63.2188" x1="109" y2="592.7061" style="stroke:#A80036;stroke-width:1.0;" x2="109"></line><line y1="592.7061" x1="109" y2="624.7061" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x2="109"></line><line y1="624.7061" x1="109" y2="712.8408" style="stroke:#A80036;stroke-width:1.0;" x2="109"></line><line y1="712.8408" x1="109" y2="744.8408" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x2="109"></line><line y1="744.8408" x1="109" y2="761.8408" style="stroke:#A80036;stroke-width:1.0;" x2="109"></line><line y1="63.2188" x1="392.5" y2="592.7061" style="stroke:#A80036;stroke-width:1.0;" x2="392.5"></line><line y1="592.7061" x1="392.5" y2="624.7061" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x2="392.5"></line><line y1="624.7061" x1="392.5" y2="712.8408" style="stroke:#A80036;stroke-width:1.0;" x2="392.5"></line><line y1="712.8408" x1="392.5" y2="744.8408" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x2="392.5"></line><line y1="744.8408" x1="392.5" y2="761.8408" style="stroke:#A80036;stroke-width:1.0;" x2="392.5"></line><line y1="63.2188" x1="575.5" y2="592.7061" style="stroke:#A80036;stroke-width:1.0;" x2="575.5"></line><line y1="592.7061" x1="575.5" y2="624.7061" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x2="575.5"></line><line y1="624.7061" x1="575.5" y2="712.8408" style="stroke:#A80036;stroke-width:1.0;" x2="575.5"></line><line y1="712.8408" x1="575.5" y2="744.8408" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x2="575.5"></line><line y1="744.8408" x1="575.5" y2="761.8408" style="stroke:#A80036;stroke-width:1.0;" x2="575.5"></line><rect filter="url(#f1n8bfz5kk7rs7)" width="95" x="60" y="5" style="stroke:#A80036;stroke-width:1.5;" fill="#FEFECE" height="53.2188"></rect><text lengthAdjust="spacing" x="69" font-size="14" textLength="77" y="28.5332" font-family="sans-serif" fill="#000000">FHIR Server</text><text lengthAdjust="spacing" x="76.5" font-size="14" textLength="62" y="46.1426" font-family="sans-serif" fill="#000000">REST API</text><rect filter="url(#f1n8bfz5kk7rs7)" width="95" x="60" y="760.8408" style="stroke:#A80036;stroke-width:1.5;" fill="#FEFECE" height="53.2188"></rect><text lengthAdjust="spacing" x="69" font-size="14" textLength="77" y="784.374" font-family="sans-serif" fill="#000000">FHIR Server</text><text lengthAdjust="spacing" x="76.5" font-size="14" textLength="62" y="801.9834" font-family="sans-serif" fill="#000000">REST API</text><rect filter="url(#f1n8bfz5kk7rs7)" width="54" x="363.5" y="22.6094" style="stroke:#A80036;stroke-width:1.5;" fill="#FEFECE" height="35.6094"></rect><text lengthAdjust="spacing" x="372.5" font-size="14" textLength="36" y="46.1426" font-family="sans-serif" fill="#000000">Client</text><rect filter="url(#f1n8bfz5kk7rs7)" width="54" x="363.5" y="760.8408" style="stroke:#A80036;stroke-width:1.5;" fill="#FEFECE" height="35.6094"></rect><text lengthAdjust="spacing" x="372.5" font-size="14" textLength="36" y="784.374" font-family="sans-serif" fill="#000000">Client</text><rect filter="url(#f1n8bfz5kk7rs7)" width="124" x="511.5" y="5" style="stroke:#A80036;stroke-width:1.5;" fill="#FEFECE" height="53.2188"></rect><text lengthAdjust="spacing" x="533.5" font-size="14" textLength="80" y="28.5332" font-family="sans-serif" fill="#000000">Email Server</text><text lengthAdjust="spacing" x="520.5" font-size="14" textLength="106" y="46.1426" font-family="sans-serif" fill="#000000">(SMTP/S, Direct)</text><rect filter="url(#f1n8bfz5kk7rs7)" width="124" x="511.5" y="760.8408" style="stroke:#A80036;stroke-width:1.5;" fill="#FEFECE" height="53.2188"></rect><text lengthAdjust="spacing" x="533.5" font-size="14" textLength="80" y="784.374" font-family="sans-serif" fill="#000000">Email Server</text><text lengthAdjust="spacing" x="520.5" font-size="14" textLength="106" y="801.9834" font-family="sans-serif" fill="#000000">(SMTP/S, Direct)</text><path d="M10,80.2188 L227,80.2188 L227,92.2188 L217,102.2188 L10,102.2188 L10,80.2188 " style="stroke:#000000;stroke-width:1.0;" fill="#EEEEEE"></path><rect width="679.5" x="10" y="80.2188" style="stroke:#000000;stroke-width:2.0;" fill="none" height="388.001"></rect><text font-weight="bold" lengthAdjust="spacing" x="27" font-size="13" textLength="168" y="96.7139" font-family="sans-serif" fill="#000000">Negotiating a Subscription</text><polygon style="stroke:#A80036;stroke-width:1.0;" fill="#A80036" points="120.5,141.8955,110.5,145.8955,120.5,149.8955,116.5,145.8955"></polygon><line y1="145.8955" x1="114.5" y2="145.8955" style="stroke:#A80036;stroke-width:1.0;" x2="391.5"></line><text font-weight="bold" lengthAdjust="spacing" x="128.5" font-size="13" textLength="7" y="130.5522" font-family="sans-serif" fill="#000000">1</text><text lengthAdjust="spacing" x="143.5" font-size="13" textLength="114" y="122.0654" font-family="sans-serif" fill="#000000">Create Subscription</text><text lengthAdjust="spacing" x="143.5" font-size="13" textLength="144" y="137.9917" font-family="monospace" fill="#000000">channelType:&nbsp;email</text><line y1="154.8955" x1="10" y2="154.8955" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x2="689.5"></line><text font-weight="bold" lengthAdjust="spacing" x="17" font-size="11" textLength="114" y="168.3145" font-family="sans-serif" fill="#000000">[Without handshake]</text><polygon style="stroke:#A80036;stroke-width:1.0;" fill="#A80036" points="380.5,213.0566,390.5,217.0566,380.5,221.0566,384.5,217.0566"></polygon><line y1="217.0566" x1="109.5" y2="217.0566" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x2="386.5"></line><text font-weight="bold" lengthAdjust="spacing" x="118.5" font-size="13" textLength="7" y="201.7134" font-family="sans-serif" fill="#000000">2</text><text lengthAdjust="spacing" x="133.5" font-size="13" textLength="51" y="193.2266" font-family="sans-serif" fill="#000000">Success</text><text lengthAdjust="spacing" x="133.5" font-size="13" textLength="216" y="209.1528" font-family="monospace" fill="#000000">Subscription.status:&nbsp;active</text><line y1="251.0566" x1="10" y2="251.0566" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x2="689.5"></line><text font-weight="bold" lengthAdjust="spacing" x="17" font-size="11" textLength="96" y="264.4756" font-family="sans-serif" fill="#000000">[With handshake]</text><polygon style="stroke:#A80036;stroke-width:1.0;" fill="#A80036" points="380.5,309.2178,390.5,313.2178,380.5,317.2178,384.5,313.2178"></polygon><line y1="313.2178" x1="109.5" y2="313.2178" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x2="386.5"></line><text font-weight="bold" lengthAdjust="spacing" x="118.5" font-size="13" textLength="7" y="297.8745" font-family="sans-serif" fill="#000000">3</text><text lengthAdjust="spacing" x="133.5" font-size="13" textLength="51" y="289.3877" font-family="sans-serif" fill="#000000">Success</text><text lengthAdjust="spacing" x="133.5" font-size="13" textLength="240" y="305.314" font-family="monospace" fill="#000000">Subscription.status:&nbsp;requested</text><polygon style="stroke:#A80036;stroke-width:1.0;" fill="#A80036" points="563.5,343.5693,573.5,347.5693,563.5,351.5693,567.5,347.5693"></polygon><line y1="347.5693" x1="109.5" y2="347.5693" style="stroke:#A80036;stroke-width:1.0;" x2="569.5"></line><text font-weight="bold" lengthAdjust="spacing" x="118.5" font-size="13" textLength="7" y="340.7129" font-family="sans-serif" fill="#000000">4</text><text lengthAdjust="spacing" x="133.5" font-size="13" textLength="190" y="340.7129" font-family="sans-serif" fill="#000000">Message with opt-in/opt-out, etc.</text><polygon style="stroke:#A80036;stroke-width:1.0;" fill="#A80036" points="120.5,394.8945,110.5,398.8945,120.5,402.8945,116.5,398.8945"></polygon><line y1="398.8945" x1="114.5" y2="398.8945" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x2="574.5"></line><text font-weight="bold" lengthAdjust="spacing" x="128.5" font-size="13" textLength="7" y="383.5513" font-family="sans-serif" fill="#000000">5</text><text lengthAdjust="spacing" x="143.5" font-size="13" textLength="125" y="375.0645" font-family="sans-serif" fill="#000000">SMTP Success, e.g.:</text><text lengthAdjust="spacing" x="143.5" font-size="13" textLength="56" y="390.9907" font-family="monospace" fill="#000000">250:&nbsp;OK</text><path filter="url(#f1n8bfz5kk7rs7)" d="M114,411.8945 L114,458.8945 L355,458.8945 L355,421.8945 L345,411.8945 L114,411.8945 " style="stroke:#A80036;stroke-width:1.0;" fill="#FBFB77"></path><path d="M345,411.8945 L345,421.8945 L355,421.8945 L345,411.8945 " style="stroke:#A80036;stroke-width:1.0;" fill="#FBFB77"></path><text lengthAdjust="spacing" x="122" font-size="13" textLength="166" y="432.3896" font-family="sans-serif" fill="#000000">Server updates Subscription:</text><text lengthAdjust="spacing" x="122" font-size="13" textLength="216" y="448.3159" font-family="monospace" fill="#000000">Subscription.status:&nbsp;active</text><path d="M10,482.2197 L168,482.2197 L168,494.2197 L158,504.2197 L10,504.2197 L10,482.2197 " style="stroke:#000000;stroke-width:1.0;" fill="#EEEEEE"></path><rect width="679.5" x="10" y="482.2197" style="stroke:#000000;stroke-width:2.0;" fill="none" height="262.6211"></rect><text font-weight="bold" lengthAdjust="spacing" x="27" font-size="13" textLength="109" y="498.7148" font-family="sans-serif" fill="#000000">Email Processing</text><line y1="505.5713" x1="10" y2="505.5713" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x2="689.5"></line><text font-weight="bold" lengthAdjust="spacing" x="17" font-size="11" textLength="105" y="518.9902" font-family="sans-serif" fill="#000000">[Bundle: heartbeat]</text><polygon style="stroke:#A80036;stroke-width:1.0;" fill="#A80036" points="563.5,580.7061,573.5,584.7061,563.5,588.7061,567.5,584.7061"></polygon><line y1="584.7061" x1="109.5" y2="584.7061" style="stroke:#A80036;stroke-width:1.0;" x2="569.5"></line><text font-weight="bold" lengthAdjust="spacing" x="118.5" font-size="13" textLength="7" y="560.876" font-family="sans-serif" fill="#000000">6</text><text lengthAdjust="spacing" x="133.5" font-size="13" textLength="307" y="543.9023" font-family="sans-serif" fill="#000000">Message with readable content and attached Bundle:</text><text lengthAdjust="spacing" x="229.5" font-size="13" textLength="160" y="559.8286" font-family="monospace" fill="#000000">Bundle.type:&nbsp;history</text><text lengthAdjust="spacing" x="133.5" font-size="13" textLength="272" y="576.8022" font-family="monospace" fill="#000000">SubscriptionStatus.type:&nbsp;heartbeat</text><line y1="625.7061" x1="10" y2="625.7061" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x2="689.5"></line><text font-weight="bold" lengthAdjust="spacing" x="17" font-size="11" textLength="148" y="639.125" font-family="sans-serif" fill="#000000">[Bundle: event-notification]</text><polygon style="stroke:#A80036;stroke-width:1.0;" fill="#A80036" points="563.5,700.8408,573.5,704.8408,563.5,708.8408,567.5,704.8408"></polygon><line y1="704.8408" x1="109.5" y2="704.8408" style="stroke:#A80036;stroke-width:1.0;" x2="569.5"></line><text font-weight="bold" lengthAdjust="spacing" x="118.5" font-size="13" textLength="7" y="681.0107" font-family="sans-serif" fill="#000000">7</text><text lengthAdjust="spacing" x="133.5" font-size="13" textLength="307" y="664.0371" font-family="sans-serif" fill="#000000">Message with readable content and attached Bundle:</text><text lengthAdjust="spacing" x="229.5" font-size="13" textLength="160" y="679.9634" font-family="monospace" fill="#000000">Bundle.type:&nbsp;history</text><text lengthAdjust="spacing" x="133.5" font-size="13" textLength="344" y="696.937" font-family="monospace" fill="#000000">SubscriptionStatus.type:&nbsp;event-notification</text></g></svg>
  <figcaption>Diagram showing a possible workflow for email subscriptions</figcaption>
</figure>

<ol>
  <li>Client creates a Subscription with the channelType set to <code class="language-plaintext highlighter-rouge">email</code>.</li>
  <li>Server may respond with a success code and create the subscription with a state of <code class="language-plaintext highlighter-rouge">active</code>.</li>
  <li>Server may respond with a success code and create the subscription with a state of <code class="language-plaintext highlighter-rouge">requested</code>.</li>
  <li>Server sends an initial message via the specified email server (e.g., verify the request, opt-out instructions, etc.).</li>
  <li>Email Server responds with a channel appropriate response code (e.g., <code class="language-plaintext highlighter-rouge">250: OK</code>).</li>
  <li>Server may send notifications of type <code class="language-plaintext highlighter-rouge">heartbeat</code> at any time.</li>
  <li>Server may send notifications of type <code class="language-plaintext highlighter-rouge">event-notification</code> at any time.</li>
</ol>

<h5 id="security-notes-2">Security Notes</h5>

<p>Email (SMTP) is not a secure channel. Implementers must ensure that any messages containing PHI have been secured according to their policy requirements (e.g., use of a system such as <a href="http://directproject.org/">Direct</a>).</p>

<h4 id="fhir-messaging-1">FHIR Messaging</h4>

<p>There are times when it is desireable to use Subscriptions as a communication channel between FHIR servers. This can be accomplished using a <code class="language-plaintext highlighter-rouge">Subscription</code> with the channel type of <code class="language-plaintext highlighter-rouge">message</code>.</p>

<p>To receive notifications via messaging, a client should request a subscription with the channel type of <code class="language-plaintext highlighter-rouge">message</code> and set the endpoint to the destination FHIR server base URL. Note that this URL must be accessible by the hosting server.</p>

<p>The FHIR server hosting the subscription (server) will send FHIR messages to the destination FHIR server (endpoint) as needed. These messages will, as the contents of the message, have a fully-formed notification Bundle.</p>

<p>An example workflow for receiving notification via FHIR messaging is shown below:</p>

<p><img src="subscription-message-flow.svg" alt="Diagram showing a workflow for FHIR messaging subscriptions" style="float:none;"/></p>

<ol>
  <li>Client creates a Subscription with the channelType set to <code class="language-plaintext highlighter-rouge">message</code>.</li>
  <li>Server responds with a success code and creates the subscription with a state of <code class="language-plaintext highlighter-rouge">requested</code>.</li>
  <li>Server sends a FHIR Message to the requested endpoint with a <code class="language-plaintext highlighter-rouge">handshake</code> notification.</li>
  <li>Client Endpoint accepts the Message and returns success.</li>
  <li>Server may send notifications of type <code class="language-plaintext highlighter-rouge">heartbeat</code> at any time.</li>
  <li>Server may send notifications of type <code class="language-plaintext highlighter-rouge">event-notification</code> at any time.</li>
</ol>

<h5 id="security-notes-3">Security Notes</h5>

<p>Servers MAY require that the end-point is allow-listed prior to allowing these kinds of subscriptions. Additionally, servers MAY impose authorization/authentication requirements for server to server communication (e.g., certificate pinning, etc.).</p>



</div>
        </div>    <!-- /inner-wrapper -->
      </div>    <!-- /row -->
    </div>    <!-- /container -->
  </div>    <!-- /segment-content -->

  <script src="assets/js/jquery.js" type="text/javascript"> </script>       <!-- note keep space here, otherwise it will be transformed to empty tag -> fails -->
  <script src="assets/js/jquery-ui.min.js" type="text/javascript"> </script>

  <script type="text/javascript">
    $(document).ready(function(){
      if(window.location.hash != "") {
          $('a[href="' + window.location.hash + '"]').click()
      }
    });
  </script>
  <a name="bottom"> </a>
  <div igtool="footer" id="segment-footer" class="segment">    <!-- segment-footer -->
    <div class="container">    <!-- container -->

      <div class="inner-wrapper">
        <p><a name="1535d0ae-004f-4dca-a1e2-9a1c93e4aca4">​</a>
          IG &copy; 2020+ <a style="color:var(--footer-hyperlink-text-color)" href="https://hl7.org/Special/committees/fiwg/index.cfm">HL7 FHIR Infrastructure WG</a>.  Package hl7.fhir.uv.subscriptions-backport#0.1.0 based on <a style="color: var(--footer-hyperlink-text-color)" href="http://build.fhir.org/">FHIR 4.1.0</a>. Generated <span title="Fri, Oct 8, 2021 10:44-0500">2021-10-08</span>
          <br/>
          <span style="color: var(--footer-highlight-text-color)"></span>
                      Links: <a style="color: var(--footer-hyperlink-text-color)" href="toc.html">Table of Contents</a> |
                 <a style="color: var(--footer-hyperlink-text-color)" href="qa.html">QA Report</a>
                 
                
               | <a style="color: #81BEF7" href="http://hl7.org/fhir/uv/subscriptions-backport/history.html" target="_blank">Version History  |
               <a style="color: #81BEF7" href="searchform.html" target="_blank">Search  |
                 <a rel="license" style="color: #81BEF7" href="http://build.fhir.org/license.html"><img src="cc0.png" alt="CC0" style="border-style: none;"/></a> |
                   <!-- <a style="color: #81BEF7" href="todo.html">Search</a> | --> 
                 <a style="color: #81BEF7" href="http://hl7.org/fhir-issues" target="_blank">Propose a change </a>

          
        
          <!-- /inner-wrapper -->
        <!-- /container -->
      <!-- /segment-footer -->
  
  <div id="segment-post-footer" class="segment hidden">    <!-- segment-post-footer -->
    <div class="container">    <!-- container -->
    </div>    <!-- /container -->
  </div>    <!-- /segment-post-footer -->
  
    <!-- JS and analytics only. -->
    <!-- Bootstrap core JavaScript
  ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
  <script src="assets/js/bootstrap.min.js" type="text/javascript"> </script>
  <script src="assets/js/respond.min.js" type="text/javascript"> </script>
  <script src="assets/js/anchor.min.js" type="text/javascript"> </script>
  <script>anchors.options.visible = 'hover'
anchors.add()</script>
  
  <!-- feedback form - Google forms -->
  <!-- v0.1, 2021-01-09 -->



  <!-- / feedback form -->

    <!-- Analytics Below
  ================================================== -->
  


</a></a></p></div></div></div></body></html>